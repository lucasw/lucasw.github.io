---
layout: post
title: Docker
---


```
sudo apt-get install docker
```

This version looks a little old (1.6.2), probably want to get more up to date later.

Add user to docker group in /etc/group.

logout login

```
docker pull ubuntu
latest: Pulling from ubuntu
454970bd163b: Pull complete 
38112156678d: Pull complete 
4e1f7c524148: Pull complete 
56063ad57855: Pull complete 
Digest: sha256:4e85ebe01d056b43955250bbac22bdb8734271122e3c78d21e55ee235fc6802d
Status: Downloaded newer image for ubuntu:latest
```

## Custom docker build based on ubuntu 14.04

Want to make a docker image that can act like a ros buildfarm master repo and slave- not sure if that is possible or requires a lot of extra configuration.

```
FROM ubuntu:14.04
# https://github.com/ros-infrastructure/buildfarm_deployment_config/blob/master/install_prerequisites.bash
RUN apt-get update && \
  apt-get -y install \
          git \
          ruby ruby1.9.1-dev make
RUN gem install puppet -v 3.7 --no-rdoc --no-ri
RUN gem install gem install librarian-puppet --no-rdoc --no-ri

RUN apt-get -y install python3-pip
RUN pip3 install -U pip
```

Build it:

...
docker build -t ros_buildfarm_mrs .
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline
debconf: unable to initialize frontend: Readline
debconf: (This frontend requires a controlling tty.)
debconf: falling back to frontend: Teletype
dpkg-preconfigure: unable to re-open stdin: 
...
Setting up rsync (3.1.0-2ubuntu0.2) ...
 Removing any system startup links for /etc/init.d/rsync ...
update-rc.d: warning: default stop runlevel arguments (0 1 6) do not match rsync Default-Stop values (none)
 Adding system startup for /etc/init.d/rsync ...
   /etc/rc0.d/K20rsync -> ../init.d/rsync
   /etc/rc1.d/K20rsync -> ../init.d/rsync
   /etc/rc6.d/K20rsync -> ../init.d/rsync
   /etc/rc2.d/S20rsync -> ../init.d/rsync
   /etc/rc3.d/S20rsync -> ../init.d/rsync
   /etc/rc4.d/S20rsync -> ../init.d/rsync
   /etc/rc5.d/S20rsync -> ../init.d/rsync
invoke-rc.d: policy-rc.d denied execution of restart.
Setting up xauth (1:1.0.7-1ubuntu1) ...
Setting up binutils (2.24-5ubuntu14) ...
Setting up cpp-4.8 (4.8.4-2ubuntu1~14.04.1) ...
Setting up cpp (4:4.8.2-1ubuntu6) ...
...
Successfully installed puppet-3.7.0
4 gems installed
 ---> 9680771bc4b7
Removing intermediate container 669cdeb77d41
Step 3 : RUN gem install gem install librarian-puppet --no-rdoc --no-ri
 ---> Running in 56b8abab1e89
ERROR:  Could not find a valid gem 'gem' (>= 0) in any repository
ERROR:  Could not find a valid gem 'install' (>= 0) in any repository
ERROR:  Possible alternatives: installr, instapi, instant, ptinstall, stall
...
Successfully installed puppet_forge-1.0.5
Successfully installed librarian-puppet-2.2.1
17 gems installed
INFO[0199] The command [/bin/sh -c gem install gem install librarian-puppet --no-rdoc --no-ri] returned a non-zero code: 2 
```

There was a typo in the Dockerfile, fixed.

```
FROM ubuntu:14.04
# Could just run the install script directly
# https://github.com/ros-infrastructure/buildfarm_deployment_config/blob/master/install_prerequisites.bash
RUN apt-get update && \
  apt-get -y install \
          git \
          ruby ruby1.9.1-dev make
RUN gem install puppet -v 3.7 --no-rdoc --no-ri
RUN gem install librarian-puppet --no-rdoc --no-ri

RUN apt-get -y install python3-pip
RUN pip3 install -U pip
RUN librarian-puppet config rsync true --global

```


If I run it again does it start from scratch, or build off of the previous build?

It uses a cache:

```
$ docker build -t ros_buildfarm_mrs .
Sending build context to Docker daemon 2.048 kB
Sending build context to Docker daemon 
Step 0 : FROM ubuntu:14.04
 ---> 56063ad57855
Step 1 : RUN apt-get update &&   apt-get -y install           git           ruby ruby1.9.1-dev make
 ---> Using cache
 ---> c6508592480f
Step 2 : RUN gem install puppet -v 3.7 --no-rdoc --no-ri
 ---> Using cache
 ---> 9680771bc4b7
Step 3 : RUN gem install librarian-puppet --no-rdoc --no-ri
 ---> Using cache
 ---> 4a84af73da61
Step 4 : RUN apt-get -y install python3-pip
 ---> Using cache
 ---> 1521e9f2f616
Step 5 : RUN pip3 install -U pip
 ---> Using cache
 ---> 075389a7524b
Step 6 : RUN librarian-puppet config rsync true --global
 ---> Using cache
 ---> 641f3ec7cf78
Successfully built 641f3ec7cf78
```

